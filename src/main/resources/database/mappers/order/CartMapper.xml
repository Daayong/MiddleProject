<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.d.mp.order.cart.CartDAO">

<!-- ===== ===== ===== INSERT ===== ===== ===== -->
	<insert id="insert_cart" parameterType="CartDTO">
		INSERT INTO cart VALUES(
		    cart_id_seq.NEXTVAL,
		    #{member_id},
		    #{product_id},
		    NULL,
		    #{quantity},
		    'checked'
		)
	</insert>


<!-- ===== ===== ===== SELECT ===== ===== ===== -->	
	<select id="getCartList" resultType="CartListDTO" parameterType="MemberDTO">
		SELECT
			cart_id,
            p.product_id AS product_id,
			TO_CHAR(cart_delivery_date, 'YYYY-MM-DD(DY)') AS cart_delivery_date,
			cart_quantity,
			cart_state,
			product_name,
			product_price,
            product_file_ori_name
		FROM
			cart c
			JOIN product p
			ON c.product_id = p.product_id
            JOIN product_file pf
            ON p.product_id = pf.product_id
		WHERE
            c.member_id = #{member_id} AND
            (c.cart_state = 'checked' OR
            c.cart_state = 'unChecked' OR
            c.cart_state = 'deadLine') AND
            pf.product_file_path = 'main'
		ORDER BY cart_delivery_date
	</select>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.d.mp.order.cart.CartDAO">

<!-- ===== ===== ===== INSERT ===== ===== ===== -->
	<insert id="insert_cart" parameterType="CartDTO">
		INSERT INTO cart VALUES(
		    cart_id_seq.NEXTVAL,
		    #{member_id},
		    #{product_id},
		    NULL,
		    #{cart_delivery_date},
		    #{quantity},
		    'checked'
		)
	</insert>


<!-- ===== ===== ===== SELECT ===== ===== ===== -->	
	<select id="getCartList" resultType="CartListDTO" parameterType="MemberDTO">
		SELECT
			cart_id,
            p.product_id AS product_id,
			TO_CHAR(cart_delivery_date, 'YYYY-MM-DD(DY)') AS cart_delivery_date,
			cart_quantity,
			cart_state,
			product_name,
			product_price,
            product_file_ori_name
		FROM
			cart c
			JOIN product p
			ON c.product_id = p.product_id
            JOIN product_file pf
            ON p.product_id = pf.product_id
		WHERE
            c.member_id = #{member_id} AND
            (c.cart_state = 'checked' OR
            c.cart_state = 'unChecked' OR
            c.cart_state = 'deadLine') AND
            pf.product_file_path = 'main'
		ORDER BY cart_delivery_date
	</select>
	
<!-- ===== ===== ===== DELETE ===== ===== ===== -->	
	<delete id="deleteCartOne" parameterType="CartDTO">
		DELETE FROM cart WHERE cart_id = #{cart_id}
	</delete>
	
	
<!-- ===== ===== ===== UPDATE ===== ===== ===== -->	
	<update id="updateCartQuantity" parameterType="CartDTO">
		UPDATE cart SET cart_quantity = #{cart_quantity} WHERE cart_id = #{cart_id}
	</update>
	
	<update id="updateCartState" parameterType="CartDTO">
		UPDATE cart SET cart_state = #{cart_state} WHERE cart_id = #{cart_id}
	</update>
	
	<update id="updateCartStateOne" parameterType="CartDTO">
		UPDATE cart SET cart_state = #{cart_state}
		WHERE
			cart_id = #{cart_id}
	</update>
	
	<update id="updateCartStateAll" parameterType="CartDTO">
		UPDATE cart SET cart_state = #{cart_state}
		WHERE
			member_id = #{member_id} AND
			(cart_state = 'checked' OR
			cart_state = 'unChecked')
	</update>
	
	<update id="updateCartStateDate" parameterType="CartDTO">
		UPDATE cart SET cart_state = #{cart_state}
		WHERE
			member_id = #{member_id} AND
			TO_CHAR(cart_delivery_date, 'YYYY-MM-DD') = #{cart_delivery_date} AND
			(cart_state = 'checked' OR
			cart_state = 'unChecked')
	</update>

</mapper>